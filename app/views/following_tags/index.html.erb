<%= render "shared/header" %>

<div class="users-list-header">
  <h2>フォロー中のユーザーを<%= @following_tag.name %>で絞り込む</h2>
  <form>
    <input type="checkbox" id="remove-follow">
    <label for="remove-follow">フォローをはずす</label>
  </form>
  <%= search_form_for @q, url: following_following_tags_path(current_user.followings.first), id: 'following-user-search-form' do |f| %>
    <%= f.label :name, 'タグで絞り込む' %><br>
    <%= f.collection_select(:name, FollowingTag.all, :id, :name, {include_blank: '---'}) %>
  <% end %>
</div>

<ul class="following-users-list">
  <% @following_items.each do |item| %>
    <% if following = Following.find_by(following_id: item.following.following_id, user_id: current_user.id) %>
      <% user = User.find(following.following_id) %>
      <li class="following-user-list-item"> 
        <%= link_to user.nickname, following_path(following) %>
        <%= link_to 'followをはずす', following_path(user), method: :delete, class: 'followed-button hidden' %>
        <div class="added-following-tag">
          <% following.following_tags_intermediates.each do |item| %>
            <div class="following-tag-item"># <%= item.following_tag.name %></div>
          <% end %>
        </div>
      </li>
    <% end %>
  <% end %>
</ul>

<%= render "shared/footer" %>